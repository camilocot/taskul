{% extends "TaskBundle::layout.html.twig" %}
    {% block body %}
    {{ parent() }}
    {% include 'TaskBundle:partials:delete-modal-rest.html.twig' %}

    {% endblock %}
{% block content %}
{{ apy_breadcrumb_trail_render() }}
<div class="row-fluid sortable">
    <div class="box span12">
        <div class="box-header" data-original-title>
            <h2><i class="icon-user"></i><span class="break"></span>Task list</h2>
            <div class="box-icon">
            <a href="#" class="btn-minimize"><i class="icon-chevron-up"></i></a>
            </div>
        </div>
        <div class="box-content">

            <table class="table table-striped table-bordered bootstrap-datatable datatable" id="list">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Description</th>
                        <th>Status</th>
                        <th>Tags</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for entity in entities %}
                    <tr>
                        <td>{{ entity.name }}</td>
                        <td>
                            {% set desc = entity.description|striptags %}
                            {% if desc|length > 30 %}
                            {{ desc|slice(0,30) }} ... <a class="boostrap-tp"  title="{{ desc }}" href="#"><i class="icon-download"></i></a>
                            {% else %}
                            {{ desc }}
                            {% endif %}</td>
                            <td>{{ entity.status|status(entity.status)|raw }}</td>
                            <td>{{ entity.tags|labelsinactive|raw }} </td>
                            <td>
                                    {% if is_granted('VIEW', entity) %}
                                        <a href="{{ path('api_get_task', { 'id': entity.id }) }}" class="btn btn-info" title="show"><i class="icon-zoom-in icon-white"></i></a>
                                        <a href="{{ path('api_get_task_files', { 'id': entity.id }) }}" class="btn btn-info" title="show"><i class="icon-zoom-in icon-white"></i></a>
                                    {% endif %}
                                    {% if is_granted('EDIT', entity) %}
                                        <a href="{{ path('api_edit_task', { 'id': entity.id }) }}" class="btn btn-success" title="edit"><i class="icon-edit icon-white"></i></a>
                                    {% endif %}
                                    {% if is_granted('DELETE', entity) %}
                                    <button class="btn btn-danger delete-modal-btn" type="button" data-id="{{ entity.id }}" data-target="#deleteModal" data-toggle="modal"><i class="icon-trash icon-white"></i></button>
                                    {% endif %}
                        </button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <div class="form-actions" style="margin: 20px -10px -8px">
                   <a href="{{ path('api_new_task') }}" class="btn">
                    Create a new entry
                    </a>
                </div>
        </div>

    </div><!--/box-->

</div><!--/row-->
{% endblock %}
{% block javascripts %}
<script src="//ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.4/jquery.dataTables.min.js"></script>
{% javascripts '@MainBundle/Resources/public/js/datatables-boostrap.js' %}
<script src="{{ asset_url }}"></script>
{% endjavascripts %}
<script type="text/javascript" src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
<script type="text/javascript" src="{{ path('fos_js_routing_js', {"callback": "fos.Router.setData"}) }}"></script>
<script type="text/javascript">
//<![CDATA[]
$(document).ready(function() {

    $('.boostrap-tp').tooltip({
        "trigger":"click"
    }).click(function(e){
        e.preventDefault();
    });

    $('.datatable').dataTable({
        "sDom": "<'row-fluid'<'span6'l><'span6'f>r>t<'row-fluid'<'span12'i><'span12 center'p>>",
        "sPaginationType": "bootstrap",
         "bAutoWidth": false,
         "aoColumns" : [
            { sWidth: '10%' },
            { sWidth: '30%' },
            { sWidth: '5%' },
            { sWidth: '40%' },
            { sWidth: '15%', "bSortable": false  }
        ],
        "oLanguage": {
            "sLengthMenu": "_MENU_ records per page"
        }
    } );

    $('.delete-modal-btn').click( function (e) {
        var taskId = $(this).data('id');
        $('#form_id').val(taskId);
        route = Routing.generate('api_delete_task', { "id": taskId });
        $('#delete-task').attr('action', route);

    });
    $('#modal-form-submit').click( function (e) {
     e.preventDefault();
     $('#delete-task').submit();
    });
});
//]]>
</script>
{% endblock %}