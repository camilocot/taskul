{% extends "TaskBundle::layout.html.twig" %}
{% block stylesheets %}
{{ parent() }}
{% stylesheets
    '@MainBundle/Resources/public/css/jquery.fileupload-ui.css'
    '@MainBundle/Resources/public/css/jasny-bootstrap.css'
    '@MainBundle/Resources/public/css/jasny-bootstrap-responsive.css'
    %}
    <link rel="stylesheet" href="{{ asset_url }}">
    {% endstylesheets %}
    {% endblock %}
{% block content %}
 {% include "TaskBundle:Upload:templates.html.twig" %}
{{ apy_breadcrumb_trail_render() }}
    <div class="row-fluid sortable">
        <div class="box span12">
            <div class="box-header" data-original-title>
                <h2><i class="icon-user"></i><span class="break"></span>Task creation</h2>
            </div>
            <div class="box-content">

<table class="table">
    <tbody>
        <tr>
            <th>Id</th>
            <td>{{ entity.id }}</td>
        </tr>
        <tr>
            <th>Name</th>
            <td>{{ entity.name }}</td>
        </tr>
        <tr>
            <th>Description</th>
            <td>{{ entity.description|raw }}</td>
        </tr>
        <tr>
            <th>Dateend</th>
            <td>{{ entity.dateEnd|date('Y-m-d H:i:s') }}</td>
        </tr>
    </tbody>
</table>
<form class="form-horizontal" action="{{ path('task_add_document', { 'id': entity.id, 'formId': uploadId }) }}" method="post"  >
<div class="file-uploader"></div>
        <div>
            <button type="submit" class="btn btn-primary">Update Files</button>
        </div>
           <div class="form-actions">
            {% if is_granted('DELETE',entity) %}
             <a class="btn btn-danger" href="{{ path('task_delete', { 'id': entity.id }) }}">
                            Delete
                        </a>
                        {% endif %}
                            {% if is_granted('EDIT',entity) %}
        <a href="{{ path('task_edit', { 'id': entity.id }) }}" class="btn btn-success">
            Edit
        </a>
    {% endif %}
                        <a class="btn btn-cancel" href="{{ path('task') }}">
                            Back to the list
                        </a>
                    </div>
</form>
</div>
</div>
</div>
    <div class="row-fluid sortable">
        <div class="box span12">
            <div class="box-header" data-original-title>
                <h2><i class="icon-user"></i><span class="break"></span>Comentarios</h2>
            </div>
            <div class="box-content">
{% include 'FOSCommentBundle:Thread:async.html.twig' with {'id': entity.id} %}
</div>
</div>
</div>
{% endblock %}
    {% block javascripts %}

    <script type="text/javascript">
//<![CDATA[
// Enable the file uploader
$(function() {
    new PunkAveFileUploader({
        'uploadUrl': {{ path('task_upload', { uploadId: uploadId, classId: entityClass , id: entity.id }) | json_encode | raw }},
        'viewUrl': '{{ '/uploads/tmp/attachments/' ~ uploadId  }}' ,
        'el': '.file-uploader',
        'existingFiles': {{ existingFiles | json_encode | raw }},
        'delaySubmitWhileUploading': '.edit-form',
        'errorCallback': function(errorObj) {
            if($('#msg-upload').length == 0)
                $('<div class="page-alert"><div class="alert alert-error"><a class="close" data-dismiss="alert">Ã—</a><span id="msg-upload"></span></div></div>').insertAfter('.navbar');
            $('#msg-upload').html($('#msg-upload').text()+"<br/>"+errorObj.error+' '+errorObj.name);
            $('.file-uploader').find('[data-spinner="1"]').hide();

        }
    });

});
//]]>
</script>
{% javascripts
    '@MainBundle/Resources/public/js/vendor/bootstrap-fileupload.js'
    '@MainBundle/Resources/public/js/vendor/jquery.ui.widget.js'
    '@MainBundle/Resources/public/js/vendor/underscore-min.js'
    '@PunkAveFileUploaderBundle/Resources/public/js/jquery.fileupload.js'
    '@FileBundle/Resources/public/js/FileUploader.js' %}
    <script src="{{ asset_url }}"></script>
    {% endjavascripts %}
{% endblock %}