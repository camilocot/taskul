{% extends "TaskBundle::layout.html.twig" %}
{% block stylesheets %}
{% stylesheets
    '@MainBundle/Resources/public/css/jquery.fileupload-ui.css'
    '@MainBundle/Resources/public/css/jasny-bootstrap.css'
    '@MainBundle/Resources/public/css/jasny-bootstrap-responsive.css'
    %}
    <link rel="stylesheet" href="{{ asset_url }}">
    {% endstylesheets %}
    {% endblock %}
{% block content %}
 {% include "TaskBundle:Upload:templates.html.twig" %}
 <div class="row-fluid">
            <div class="span9">
<h1>Task</h1>

<table class="table">
    <tbody>
        <tr>
            <th>Id</th>
            <td>{{ entity.id }}</td>
        </tr>
        <tr>
            <th>Name</th>
            <td>{{ entity.name }}</td>
        </tr>
        <tr>
            <th>Description</th>
            <td>{{ entity.description|raw }}</td>
        </tr>
        <tr>
            <th>Dateend</th>
            <td>{{ entity.dateEnd|date('Y-m-d H:i:s') }}</td>
        </tr>
    </tbody>
</table>
<ul>
{% for doc in documents %}
{% if is_granted('VIEW',doc) %}
<li>{{ doc.name }}</li>
{% endif %}
{% endfor %}
</ul>
<form class="form-horizontal well" action="{{ path('task_add_document', { 'id': entity.id, 'formId': uploadId }) }}" method="post"  >
<div class="file-uploader"></div>
        <div>
            <button type="submit" class="btn btn-primary">Update Files</button>
        </div>
</form>
{% include 'FOSCommentBundle:Thread:async.html.twig' with {'id': entity.id} %}

<ul class="record_actions">
    <li>
        <a href="{{ path('task') }}">
            Back to the list
        </a>
    </li>
    {% if is_granted('EDIT',entity) %}
    <li>
        <a href="{{ path('task_edit', { 'id': entity.id }) }}">
            Edit
        </a>
    </li>
    {% endif %}
    {% if is_granted('DELETE',entity) %}
    <li>
        <form action="{{ path('task_delete', { 'id': entity.id }) }}" method="post">
            {{ form_widget(delete_form) }}
            <button type="submit">Delete</button>
        </form>
    </li>
    {% endif %}
</ul>
</div>
</div>
{% endblock %}
    {% block javascripts %}

    <script type="text/javascript">
//<![CDATA[
// Enable the file uploader
$(function() {
    new PunkAveFileUploader({
        'uploadUrl': {{ path('task_upload', { uploadId: uploadId, classId: entityClass , id: entity.id }) | json_encode | raw }},
        'viewUrl': '{{ '/uploads/tmp/attachments/' ~ uploadId  }}' ,
        'el': '.file-uploader',
        'existingFiles': {{ existingFiles | json_encode | raw }},
        'delaySubmitWhileUploading': '.edit-form',
        'errorCallback': function(errorObj) {
            if($('#msg-upload').length == 0)
                $('<div class="page-alert"><div class="alert alert-error"><a class="close" data-dismiss="alert">Ã—</a><span id="msg-upload"></span></div></div>').insertAfter('.navbar');
            $('#msg-upload').html($('#msg-upload').text()+"<br/>"+errorObj.error+' '+errorObj.name);
            $('.file-uploader').find('[data-spinner="1"]').hide();

        }
    });

});
//]]>
</script>
{% javascripts
    '@MainBundle/Resources/public/js/vendor/bootstrap-fileupload.js'
    '@MainBundle/Resources/public/js/vendor/jquery.ui.widget.js'
    '@MainBundle/Resources/public/js/vendor/underscore-min.js'
    '@PunkAveFileUploaderBundle/Resources/public/js/jquery.fileupload.js'
    '@FileBundle/Resources/public/js/FileUploader.js' %}
    <script src="{{ asset_url }}"></script>
    {% endjavascripts %}
{% endblock %}